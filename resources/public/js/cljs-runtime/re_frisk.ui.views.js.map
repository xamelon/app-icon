{"version":3,"sources":["re_frisk/ui/views.cljs"],"mappings":"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","names":["re-frisk.ui.views/subs-view","subs","checkbox-sorted-val","state-atom","reagent.core.atom","re-frisk.ui.components.frisk/expand-by-default","_","re-frisk.ui.components.frisk/Root","cljs.core/deref","re-frisk.utils/sort-map","re-frisk.ui.views/app-db-view","app-db","tool-state","re-com.core/v-box","re-com.core/h-box","re-com.core/label","re-com.core/gap","re-com.core/checkbox","re-frisk.utils/on-change-sort","re-frisk.ui.views/main-view","re-frame-data","doc","subs-checkbox-sorted-val","open-event-split?","reagent.ratom/make-reaction","cljs.core/boolean","cljs.core.get","re-frisk.ui.components.splits/v-split","re-frisk.ui.events/event-bar","re-frisk.ui.events/event-view","var_args","args__4742__auto__","len__4736__auto__","i__4737__auto__","argseq__4743__auto__","cljs.core/IndexedSeq","re-frisk.ui.views/external-main-view","p__65850","vec__65851","cljs.core.nth","seq65847","G__65848","cljs.core/first","cljs.core/next","G__65849","self__4723__auto__","re-frisk.ui.components.splits/h-split","re-frisk.ui.events/events-view","re-frisk.ui.views/on-external-window-unload","app","reagent.dom/unmount-component-at-node","cljs.core.swap_BANG_","re-frisk.db/tool-state","cljs.core/assoc","re-frisk.ui.views/mount-external","window","goog.object/set","reagent.dom.render","re-frisk.ui.views/open-debugger-window","map__65881","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","ext_height","ext_width","win","js/window.open","or__4126__auto__","re-frisk.ui.external-hml/html-doc","re-frisk.ui.views/on-iframe-load","js/document","re-frisk.ui.views/inner-view","ext-opened?","latest-left","left","re-frisk.utils/normalize-draggable","re-frisk.ui.components.drag/draggable","js/window.innerWidth","re-frisk.ui.style/inner-view-container","re-frisk.ui.style/external-button","re-frisk.utils/closed?","re-frisk.ui.style/dragg-button","re-frisk.ui.components.drag/mouse-down-handler","re-frisk.ui.views/mount-internal","div"],"sourcesContent":["(ns re-frisk.ui.views\n  (:require-macros [reagent.ratom :refer [reaction]])\n  (:require\n   [reagent.dom :as rdom]\n   [reagent.core :as reagent]\n   [re-com.core :as re-com]\n   [re-frisk.db :as db]\n   [re-frisk.ui.events :as events]\n   [re-frisk.ui.components.splits :as splits]\n   [re-frisk.ui.components.frisk :as frisk]\n   [re-frisk.ui.style :as style]\n   [re-frisk.ui.components.drag :as drag]\n   [re-frisk.ui.external-hml :as external-hml]\n   [re-frisk.utils :as utils]))\n\n(defn subs-view [subs checkbox-sorted-val]\n  (let [state-atom (reagent/atom frisk/expand-by-default)]\n    (fn [_]\n      [frisk/Root (utils/sort-map @subs @checkbox-sorted-val checkbox-sorted-val) 0 state-atom])))\n\n(defn app-db-view [app-db tool-state]\n  (let [state-atom          (reagent/atom frisk/expand-by-default)\n        checkbox-sorted-val (reagent/atom true)]\n    (fn [_]\n      [re-com/v-box :size \"1\"\n       :children\n       [[re-com/h-box\n         :children\n         [[re-com/label :label \"app-db\"]\n          [re-com/gap :size \"20px\"]\n          [re-com/checkbox\n           :model checkbox-sorted-val\n           :on-change (utils/on-change-sort app-db checkbox-sorted-val :re-frisk-sorted)\n           :label \"sort\"]\n          (when (:app-db-delta-error @tool-state)\n            [re-com/label :label \"update error\" :style {:margin-left \"4px\" :color \"#df691a\"}])]]\n        [frisk/Root (utils/sort-map @app-db @checkbox-sorted-val checkbox-sorted-val) 0 state-atom]]])))\n\n(defn main-view [re-frame-data tool-state doc]\n  (let [subs-checkbox-sorted-val (reagent/atom true)\n        open-event-split?        (reaction (boolean (get @tool-state :selected-event)))]\n    (fn [_ _ _]\n      [re-com/v-box :size \"1\" :style {:padding \"0\"}\n       :children [[re-com/h-box :style {:background-color \"#4e5d6c\"}\n                   :children\n                   [[re-com/label :label \"Active subscriptions\"]\n                    [re-com/gap :size \"20px\"]\n                    [re-com/checkbox\n                     :model subs-checkbox-sorted-val\n                     :on-change (utils/on-change-sort (:subs re-frame-data) subs-checkbox-sorted-val [[:re-frisk-sorted] []])\n                     :label \"sort\"]\n                    (when (:subs-delta-error @tool-state)\n                      [re-com/label :label \"update error\" :style {:margin-left \"4px\" :color \"#df691a\"}])]]\n                  [splits/v-split :size \"1\" :initial-split \"0\" :style {:padding \"0\" :margin \"0\"} :document doc\n                   ;; SUBS\n                   :panel-1 [subs-view (:subs re-frame-data) subs-checkbox-sorted-val]\n                   :panel-2 [splits/v-split :size \"1\" :initial-split \"100\" :style {:padding \"0\" :margin \"0\"}\n                             :document doc :open-bottom-split? open-event-split?\n                             :panel-1 [re-com/v-box :size \"1\" :style {:background-color \"#4e5d6c\"}\n                                       :children\n                                       ;; APP-DB\n                                       [[app-db-view (:app-db re-frame-data) tool-state]\n                                        [events/event-bar tool-state]]]\n                             ;; EVENT\n                             :panel-2 [events/event-view tool-state]]]]])))\n\n(defn external-main-view [re-frame-data tool-state & [doc]]\n  [re-com/v-box :height \"100%\"\n   :children\n   [[splits/h-split :size \"1\" :initial-split \"25\" :document doc\n     ;;EVENTS\n     :panel-1 [events/events-view re-frame-data tool-state]\n     ;;MAIN (subs, app-db, event)\n     :panel-2 [main-view re-frame-data tool-state doc]]]])\n\n(defn on-external-window-unload [app]\n  (fn []\n    (rdom/unmount-component-at-node app)\n    (swap! db/tool-state assoc :ext-win-opened? false)))\n\n(defn mount-external [window doc re-frame-data]\n  (let [app (.getElementById doc \"re-frisk-debugger-div\")]\n    (goog.object/set window \"onunload\" (on-external-window-unload app))\n    (swap! db/tool-state assoc :ext-win-opened? true)\n    (rdom/render\n     [:div {:style {:height \"100%\"}}\n      [external-main-view re-frame-data db/tool-state doc]]\n     app)))\n\n(defn open-debugger-window [re-frame-data]\n  (fn []\n    (let [{:keys [ext_height ext_width]} (:opts @db/tool-state)\n          win (js/window.open \"\" \"Debugger\" (str \"width=\" (or ext_width 800)\n                                                 \",height=\" (or ext_height 800)\n                                                 \",resizable=yes,scrollbars=yes,status=no\"\n                                                 \",directories=no,toolbar=no,menubar=no\"))\n          doc (.-document win)]\n      (.open doc)\n      (.write doc external-hml/html-doc)\n      (goog.object/set win \"onload\" #(mount-external win doc re-frame-data))\n      (.close doc))))\n\n(defn on-iframe-load [re-frame-data]\n  (fn []\n    (let [doc (.-contentDocument (.getElementById js/document \"re-frisk-iframe\"))]\n      (rdom/render\n       [:div {:style {:height \"100%\"}}\n        [external-main-view re-frame-data db/tool-state doc]]\n       (.getElementById doc \"re-frisk-debugger-div\")))))\n\n(defn inner-view [re-frame-data]\n  (let [ext-opened? (reaction (:ext-win-opened? @db/tool-state))\n        latest-left (reaction (:latest-left @db/tool-state))]\n    (fn []\n      (when-not @ext-opened?\n        (let [left (or (utils/normalize-draggable (:x @drag/draggable))\n                       (- js/window.innerWidth 30))]\n          [:div {:style (style/inner-view-container left (:offset @drag/draggable))}\n           [:div {:style {:display :flex :flex-direction :column :opacity 0.3}}\n            [:div {:style    style/external-button\n                   :on-click (open-debugger-window re-frame-data)}\n             \"\\u2197\"]\n            [:div {:style {:display :flex :flex 1 :justify-content :center :flex-direction :column}}\n             [:div {:style style/external-button\n                    :on-click #(let []\n                                 (when-not (utils/closed? left)\n                                   (swap! db/tool-state assoc :latest-left (- js/window.innerWidth left)))\n                                 (swap! drag/draggable assoc :x (- js/window.innerWidth\n                                                                   (if (utils/closed? left) @latest-left 30))))}\n              (if (utils/closed? left) \"\\u2b60\" \"\\u2b62\")]\n             [:div {:style style/dragg-button\n                    :on-mouse-down drag/mouse-down-handler}]]]\n           (when-not (utils/closed? left)\n             [:div {:style {:display :flex :flex 1 :width \"100%\" :height \"100%\"}}\n              [:iframe {:id \"re-frisk-iframe\" :src-doc external-hml/html-doc :width \"100%\" :height \"100%\"\n                        :style (if (:offset @drag/draggable) {:pointer-events :none} {:pointer-events :all})\n                        :on-load (on-iframe-load re-frame-data)}]])])))))\n\n(defn mount-internal [re-frame-data]\n  (let [div (.createElement js/document \"div\")]\n    (goog.object/set div \"style\"\n          (str \"position:fixed; top:0; left:0; bottom:0; right:0; width:100%; height:100%; border:none;\"\n               \"margin:0; padding:0; z-index:999999999;pointer-events: none;\"))\n    (.appendChild (.-body js/document) div)\n    (rdom/render [inner-view re-frame-data] div)))"]}